<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat</title>
  <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css">
  <script src="//cdn.bootcss.com/socket.io/1.4.8/socket.io.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
  <style>

  </style>
</head>
<body>
  <div class="section">
    <ul class="messages">
    </ul>
    <div class="send-box">
      <textarea class="form-control"></textarea>
    </div>
    <script>


      var socket = io('http://socket.usingnet.net?token=token_im_4fad5069bda6e5af28');


      


      // get token
      /*
      var from = 'd1nilku8blg30adljnkqgbjd630th4m1';
      var to = '943b3255785a550a13e007f63a6e58b8';
      var HOST = 'http://socket.usingnet.net';
      var INIT_API = `${HOST}/api/message/client/init?from=${from}&to=${to}`;
      var SOCKET_API = `ws://socket.usingnet.net/ws`;
      var CONFIG_API = `${HOST}/api/message/client/config?from=${from}&to=${to}`;
      var SEND_API = `${HOST}/api/message/client`;
      $.ajax({
        url: INIT_API,
        method: 'GET'
      }).then((resp) => {
          if (resp.success) {
            var token = resp.token;
            $.ajax({
              url: `${CONFIG_API}&token=${token}`,
              method: 'GET',
            }).then((resp) => {
              var messages = template(resp.messages);
              $('.messages').html(messages);
              var socket = io(`${SOCKET_API}?token=${token}`);
              socket.on('message', function (message) {
                 var newMessage = template(message);
                 $('.messages').append(newMessage);
              });
            });
          }
      });

      function template(_messages) {
        var messages = [];
        _messages.forEach(message => {
          messages.push(`<li class="item ${message.type.toLowerCase()}">${message.body}</li>`)
        })
        return messages.join('');
      }
      */

    </script>
  </div>
</body>
</html>
